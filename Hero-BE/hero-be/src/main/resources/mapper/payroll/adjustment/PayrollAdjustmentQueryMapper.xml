<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
  <pre>
  Mapper Name : PayrollAdjustmentQueryMapper
  Description : 급여 조정(PayrollAdjustment) 조회 전용 MyBatis 매퍼

  History
   2025/12/31 - 동근 최초 작성
  </pre>
-->

<mapper namespace="com.c4.hero.domain.payroll.adjustment.mapper.PayrollAdjustmentQueryMapper">

<!--  승인된 급여 조정 내역의 순 조정 금액(net) 합계 조회   -->
    <select id="sumApprovedAdjustmentNet" resultType="int">
        SELECT
            COALESCE(SUM(
                             CASE
                                 WHEN a.sign = '-' THEN -a.amount
                                 ELSE a.amount
                                 END
                     ), 0) AS net
        FROM tbl_payroll_adjustment a
                 JOIN tbl_payroll p
                      ON p.payroll_id = a.payroll_id
        WHERE p.employee_id = #{employeeId}
          AND a.effective_month = #{salaryMonth}
          AND a.status = 'APPROVED'
    </select>

</mapper>
