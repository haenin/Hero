<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--
<pre>
 Class Name: EvaluationEmployeeMapper.xml
 Description: 피평가자 조회 관련 Mybatis Mapper

 History
 2025/12/12 (김승민) 최초 작성
</pre>

@author 김승민
-->

<mapper namespace="com.c4.hero.domain.evaluation.mapper.EvaluationEmployeeMapper">

    <resultMap id="EvaluationEmployeeMap" type="com.c4.hero.domain.evaluation.dto.employee.EmployeeResponseDTO">
        <id property="employeeEmployeeId" column="employee_id"/>
        <result property="employeeEmployeeName" column="employee_name"/>
        <result property="employeeDepartmentId" column="department_id"/>
        <result property="employeeDepartmentName" column="department_name"/>
        <result property="employeeGradeId" column="grade_id"/>
        <result property="employeeGrade" column="grade"/>
        <result property="employeeStatus" column="status"/>
    </resultMap>

    <select id="selectEmployeeByDepartmentId" parameterType="int" resultMap="EvaluationEmployeeMap">
        SELECT
            e.employee_id,
            e.employee_name,
            d.department_id,
            d.department_name,
            g.grade_id,
            g.grade,
            e.status
        FROM tbl_employee e
        JOIN tbl_department d ON e.department_id = d.department_id
        JOIN tbl_grade g ON e.grade_id = g.grade_id
        WHERE e.department_id = #{departmentId}
          AND e.status = 'A'
          AND (d.manager_id IS NULL OR e.employee_id != d.manager_id)
    </select>

</mapper>
